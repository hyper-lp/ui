generator client {
  provider      = "prisma-client-js"
  output        = "../../src/generated/prisma-monitoring"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL_MONITORING")
}

// Simple snapshot storage - stores entire AccountSnapshot as JSON
model AccountSnapshot {
  id           String   @id @default(cuid())
  address      String   // Single address field for the account
  timestamp    DateTime @db.Timestamptz
  evmAddress   String
  coreAddress  String
  
  // Store the entire snapshot as JSON
  snapshot     Json
  
  // Extract key metrics for indexing/querying
  totalUSD     Decimal  @db.Decimal(38, 18)
  netDeltaHYPE Decimal  @db.Decimal(38, 18)
  
  createdAt    DateTime @default(now())

  @@unique([address, timestamp])
  @@index([address])
  @@index([timestamp])
  @@index([evmAddress])
  @@index([coreAddress])
  @@index([address, timestamp])
  @@index([evmAddress, timestamp])
  @@index([coreAddress, timestamp])
}

// Track addresses that have used the snapshot API
model ApiUser {
  id          String   @id @default(cuid())
  address     String   @unique
  firstSeen   DateTime @default(now())
  lastSeen    DateTime @updatedAt
  queryCount  Int      @default(1)
  
  @@index([firstSeen])
  @@index([lastSeen])
}